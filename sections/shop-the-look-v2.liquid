{% comment %}
  <div class="top-[10%] left-[10%] top-[20%] left-[20%] top-[30%] left-[30%] top-[40%] left-[40%] top-[50%] left-[50%] top-[60%] left-[60%] top-[70%] left-[70%] top-[80%] left-[80%] top-[90%] left-[90%] top-[100%] left-[100%]"></div>
{% endcomment %}
{% style %}
  #shop-the-look-section-{{ section.id }}{
    margin-top:{{ section.settings.margin_top_mob }}px;
    margin-bottom:{{ section.settings.margin_bottom_mob }}px;
  }
  {% for block in section.blocks %}
  .tooltips_rang[data-index="{{ forloop.index}}"]{
    top:{{block.settings.mob_dot_range_top}}%;
    left:{{block.settings.mob_dot_range_left}}%;
  }
  {% endfor %}
  @media(min-width:768px){
    #shop-the-look-section-{{ section.id }}{
     margin-top:{{ section.settings.margin_top_desktop }}px;
    margin-bottom:{{ section.settings.margin_bottom_desktop }}px;
    }

    {% for block in section.blocks %}
    .tooltips_rang[data-index="{{ forloop.index}}"]{
      top:{{block.settings.dot_range_top}}%;
      left:{{block.settings.dot_range_left}}%
    }
    {% endfor %}
  }
{% endstyle %}
<section
  class="flex flex-col shop-the-look items-center md:px-10 md:py-[80px] bg-[#f7f3ed]"
  id="shop-the-look-section-{{ section.id }}"
>
  <div class="m-container:max-w-[1600px] m-container:mx-auto w-full">
    <div class="md:flex md:flex-row md:gap-[15px] lg:gap-[50px] xl:gap-[60px] lg:items-center">
      <div class="keen-slider flex overflow-hidden lg:h-max 2xl:flex-[0_0_55%]" id="slider-banner">
        <div class="relative collection-image lg:h-max flex-[0_0_100%] w-full keen-slider__slide transition-all">
          {% if section.settings.image_desk != blank %}
            <div class="relative">
              <picture class="relative">
                <!-- Desktop Background Image -->
                <source media="(min-width: 768px)" srcset="{{ section.settings.image_desk | img_url: 'master' }}">
                <!-- Mobile Background Image -->
                <source media="(max-width: 767px)" srcset="{{ section.settings.image_mob | img_url: 'master' }}">
                <!-- Default Image for browsers that don't support the picture element -->
                <img
                  src="{{ section.settings.image_desk | img_url: 'master' }}"
                  alt="Background Image"
                  class="w-full h-[469px] lg:w-full lg:h-[828px] object-cover"
                  loading="lazy"
                  style="background-color: #D5D5D5"
                >
              </picture>
              <!-- Black overlay -->
              <div class="overlay absolute opacity-40 h-full w-full top-0"></div>

              <!-- Text Overlay -->
              {% if section.settings.title != blank %}
                <div class="hidden md:flex flex-col text-center absolute pb-[33px] lg:pb-[51px] px-[24px] text-white lg:max-w-[465px] w-full lg:mx-auto bottom-0 left-1/2 translate-x-[-50%]">
                  {% if section.settings.title != blank %}
                    <h2 class="font-[gascogne-serial] text-[36px] font-[250] leading-[120%] mb-[20px] capitalize">
                      {{ section.settings.title }}
                    </h2>
                  {% endif %}
                  {% if section.settings.banner_desc != blank %}
                    <p class="font-shape text-[16px] font-[300] leading-[150%]">
                      {{ section.settings.banner_desc }}
                    </p>
                  {% endif %}
                </div>
              {% endif %}
            </div>
            <!-- tooltips html start -->
            {% for block in section.blocks %}
              {% if block.settings.product != blank %}
                <div
                  class="absolute max-w-max group tooltips_rang {% if forloop.index == 1 %}active {% endif %}"
                  data-index="{{ forloop.index}}"
                >
                  <button
                    class="tooltips h-[10px] w-[10px] rounded-full bg-[#D5D5D5]"
                    data-index="{{ forloop.index}}"
                  ></button>
                  {% comment %}
                    <div class="left-[140%] left-[unset] right-[40px] right-[-11px] transform -translate-y-1/2 -scale-x-[-1] left-auto z-[100]"></div>
                  {% endcomment %}
                  <div class="absolute w-full max-w-[172px] min-w-[172px] top-1/2 transform -translate-y-1/2 flex flex-col px-3 py-2 bg-white rounded-[8px] opacity-0 z-[-1] group-hover:opacity-100 group-hover:z-[100] transition duration-300 {% if block.settings.tooltip_alignment == 'left'  %} left-[300%] lg:left-[200%] {% endif %} {% if block.settings.tooltip_alignment == 'right'  %} left-[unset] right-[24px] lg:right-[30px] {% endif %} group-[&.active]:z-[99] group-[&.active]:opacity-100">
                    <span
                      class="absolute left-[-10px] top-1/2 transform -translate-y-1/2 inline-block border-solid border-[transparent_#fff_transparent_transparent;] border-t-[12px] border-r-[12px] border-b-[12px] border-l-0 {% if block.settings.tooltip_alignment == 'right'  %} right-[-11px] transform -translate-y-1/2 scale-x-[-1] left-auto {% endif %}"
                    ></span>
                    <p class="font-shape font-bold text-[12px] tracking-[0.06px] leading-[16.2px]">
                      {{- block.settings.title_tooltip -}}
                    </p>
                    <p class="font-shape font-medium text-[12px] tracking-[0.06px] leading-[16.2px]">
                      {{ block.settings.tooltip_content }}
                    </p>
                  </div>
                </div>
              {% endif %}
            {% endfor %}
            <!-- tooltips html End -->

          {% else %}
            <div class="hidden md:visible bg-[#D5D5D5] relative">
              <div class="text-center h-[469px] lg:w-[662px] lg:h-[828px] w-full inset-0 flex items-center flex-col pb-[33px] px-[24px] justify-end text-white">
                <h2 class="font-[gascogne-serial] text-[36px] font-[250] leading-[120%] mb-[20px]">Shop the Edit</h2>
                <p class="font-shape text-[16px] font-[300] leading-[150%]">
                  Lorem ipsum dolor sit amet consectetur. Amet nisi nisl eget sagittis rutrum vel massa cursus.
                </p>
              </div>
            </div>
          {% endif %}
        </div>
      </div>

      <div class="keen-slider lg:pt-[50px] md:relative 2xl:flex-[0_0_40%]" id="slider-product">
        {% for block in section.blocks %}
          <div class="products-slider flex-[0_0_100%] bg-[#f7f3ed] pb-6 md:px-14 lg:px-[67px] keen-slider__slide">
            {% if block.settings.product != blank %}
              {%-
                render 'product-card-v2', product: block.settings.product, mobile_height: 'h-[448px]'
                , mobile_max_width:'max-w-[100%]',
                , mobile_info_bg:'bg-[#F6F3EC]',
                iconClass:"w-8 h-8",
              -%}
            {% else %}
              {%-
                render 'product-card-v2', title: 'product title', name: 'BRAND NAME', price: '$123.00'
                , mobile_height: 'h-[448px]'
                , mobile_max_width:'max-w-[100%]',
                , mobile_info_bg:'bg-[#F6F3EC]',
                iconClass:"w-8 h-8",
              -%}
            {% endif %}
          </div>
        {% endfor %}

        {% if section.blocks.size > 1 %}
          <div class="hidden md:block" data-role="navigation">
            <!-- navigation arrow code start -->
            <div class="flex w-full h-full justify-between items-center">
              <button
                class="bg-[#fff] rounded-full p-[10px] shadow-[0px_4px_24px_0px_rgba(34,_34,_34,_0.08)] h-max  absolute top-[35%] xl:top-[42.2%] left-0 transform -translate-y-1/2 focus:outline-none [&.disable]:hidden"
                data-role="nav-arrow"
                data-behave="prev"
              >
                {% render 'icon-v2', icon: 'icon-pdp-nav-left' %}
              </button>
              <button
                class="bg-[#fff] rounded-full p-[10px] shadow-[0px_4px_24px_0px_rgba(34,_34,_34,_0.08)] h-max    absolute top-[35%] xl:top-[42.2%] right-0 transform -translate-y-1/2 focus:outline-none [&.disable]:hidden"
                data-role="nav-arrow"
                data-behave="next"
              >
                {% render 'icon-v2', icon: 'icon-pdp-nav-right' %}
              </button>
            </div>
            <!-- navigation arrow code End -->
            <!-- navigation Dots code Start -->
            <div class="flex justify-center absolute left-0 w-full gap-2 bottom-0 pb-2" data-role="thumbs-dots">
              {% for block in section.blocks %}
                <button
                  class="w-2 h-2 rounded-full bg-[#e7e6e3]  [&.active]:bg-[#000] {% if forloop.index == 1 %} active {% endif %} focus:outline-none"
                  data-index="{{ forloop.index }}"
                ></button>
              {% endfor %}
            </div>
            <!-- navigation Dots code End -->
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>

{% if section.blocks.size > 1 %}
  <script>
    window[`image_slider_{{ section.id }}`] = null;
    window[`card_slider_{{ section.id }}`] = null;
    document.addEventListener('custom:keenLoaded', (e) => {
      let Slider = e.detail.slider;
      window[`image_slider_{{ section.id }}`] = new Slider('#slider-banner', {
        drag: false,
        slides: {
          perView: 1,
        },
        defaultAnimation: {
          duration: 1000,
        },
        renderMode: 'custom',
        detailsChanged: (s) => {
          s.slides.forEach((element, idx) => {
            idx == s.track.details.abs ? (element.style.position = 'relative') : (element.style.position = 'absolute');
            element.style.opacity = s.track.details.slides[idx].portion;
            element.style.zIndex = s.track.details.slides[idx].portion;
          });
        },
      });
    });

    document.addEventListener('custom:keenLoaded', (e) => {
      function WheelControls(slider) {
      var touchTimeout;
      var position;
      var wheelActive;

      function dispatch(e, name) {
        position.x -= e.deltaX;
        position.y -= e.deltaY;
        slider.container.dispatchEvent(
          new CustomEvent(name, {
            detail: {
              x: position.x,
              y: position.y,
            },
          })
        );
      }

      function wheelStart(e) {
        position = {
          x: e.pageX,
          y: e.pageY,
        };
        dispatch(e, 'ksDragStart');
      }

      function wheel(e) {
        if (e.deltaY == -0) {
          dispatch(e, 'ksDrag');
        }
      }

      function wheelEnd(e) {
        dispatch(e, 'ksDragEnd');
      }

      function eventWheel(e) {
        if (!wheelActive) {
          wheelStart(e);
          wheelActive = true;
        }
        wheel(e);
        clearTimeout(touchTimeout);
        touchTimeout = setTimeout(() => {
          wheelActive = false;
          wheelEnd(e);
        }, 50);
      }

      slider.on('created', () => {
        slider.container.addEventListener(
          'wheel',
          (e) => {
            if (e.deltaY != -0) {
              slider.container.removeEventListener('wheel', () => {});
            } else {
              eventWheel(e);
            }
          },
          { passive: false }
        );
      });
    }
      let Slid = e.detail.slider;
      window[`card_slider_{{ section.id }}`] = new Slid(
        '#slider-product',
        {
          loop: true,
          slides: {
            perView: 1,
          },
        },
        [
          (slider) => {
            slider.on('created', () => {
              let toolTips = document.querySelectorAll('#shop-the-look-section-{{ section.id }} .tooltips_rang');
              let arrows = document.querySelectorAll("#shop-the-look-section-{{ section.id }} [data-role='nav-arrow']");
              let thumbs = document.querySelectorAll(
                '#shop-the-look-section-{{ section.id }} [data-role="thumbs-dots"] button'
              );
              arrows.forEach((el) => {
                el.addEventListener('click', () => {
                  let max = slider.track.details.max;
                  let current = slider.track.details.abs;
                  if (el.dataset.behave == 'next') {
                    slider.next();
                  } else {
                     slider.prev();
                  }
                });
              });
              thumbs.forEach((el, ind) => {
                el.addEventListener('click', () => {
                  thumbs.forEach((elem) => elem.classList.remove('active'));
                  slider.moveToIdx(ind);
                  el.classList.add('active');
                });
              });
              toolTips.forEach((el, ind) => {
                el.addEventListener('click', () => {
                  slider.moveToIdx(ind);
                });
              });
            });
            slider.on('slideChanged', () => {
              let arrows = Array.from(
                document.querySelectorAll("#shop-the-look-section-{{ section.id }} [data-role='nav-arrow']")
              );
              let current = slider.track.details.rel;
              let thumbs = document.querySelectorAll(
                '#shop-the-look-section-{{ section.id }} [data-role="thumbs-dots"] button'
              );
              let toolTips = document.querySelectorAll('#shop-the-look-section-{{ section.id }} .tooltips_rang');
              thumbs.forEach((el, ind) => {
                ind == current ? el.classList.add('active') : el.classList.remove('active');
              });
              toolTips.forEach((el, ind) => {
                ind == current ? el.classList.add('active') : el.classList.remove('active');
              });
              window[`image_slider_{{ section.id }}`].moveToIdx(current);
              {% comment %} current == slider.track.details.max
                ? arrows.find((el) => el.dataset.behave == 'next').classList.add('disable')
                : arrows.find((el) => el.dataset.behave == 'next').classList.remove('disable');
              current == slider.track.details.min
                ? arrows.find((el) => el.dataset.behave == 'prev').classList.add('disable')
                : arrows.find((el) => el.dataset.behave == 'prev').classList.remove('disable'); {% endcomment %}
            });
          },
          WheelControls
        ]
      );
    });
  </script>
{% endif %}
<style>
  .overlay {
    background: #000;
    position: absolute;
    opacity: 0.4;
    width: 100%;
    height: 100%;
    top: 0px;
    left: 0px;
  }
  /*small white pulse*/

  @keyframes pulse-white-10 {
    0% {
      transform: scale(0.95);
      box-shadow: 0 0 0 0 rgba(255, 255, 255, 0.7);
    }
    70% {
      transform: scale(1);
      box-shadow: 0 0 0 10px rgba(255, 255, 255, 0);
    }
    100% {
      transform: scale(0.95);
      box-shadow: 0 0 0 0 rgba(255, 255, 255, 0);
    }
  }
  .tooltips {
    background-color: #ffffff;
    display: inline-block;
    line-height: 1;
    transition: all 0.5s;
    color: #818a91;
    text-align: center;
    border-radius: 50%;
    width: 7.96px;
    height: 7.96px;
  }
  .tooltips_rang.active .tooltips {
    animation: pulse-white-10 2s infinite;
  }
  @media (min-width: 1024px) {
    .tooltips {
      width: 14.04px;
      height: 14.04px;
    }
  }
</style>

{% schema %}
{
  "name": "Shop Look V2",
  "settings": [
    {
      "type": "range",
      "id": "margin_top_mob",
      "label": "Margin From Top Mobile",
      "step": 1,
      "min": 0,
      "max": 100,
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_top_desktop",
      "label": "Margin From Top Desktop",
      "step": 1,
      "min": 0,
      "max": 100,
      "default": 0
    },
    {
      "type": "range",
      "id": "margin_bottom_mob",
      "label": "Margin From Bottom Mobile",
      "step": 1,
      "min": 0,
      "max": 100,
      "default": 76
    },
    {
      "type": "range",
      "id": "margin_bottom_desktop",
      "label": "Margin From Bottom Desktop",
      "step": 1,
      "min": 0,
      "max": 100,
      "default": 49
    },
    {
      "type": "header",
      "content": "Banner Product"
    },
    {
      "type": "image_picker",
      "label": "Select your Mob Image",
      "id": "image_mob"
    },
    {
      "type": "image_picker",
      "label": "Select your Desk Image",
      "id": "image_desk"
    },
    {
      "type": "text",
      "id": "title",
      "label": "Title",
      "default": "Shop the Edit"
    },
    {
      "type": "textarea",
      "id": "banner_desc",
      "label": "Banner description",
      "default": "Lorem ipsum dolor sit amet consectetur. Amet nisi nisl eget sagittis rutrum vel massa cursus."
    }
  ],
  "blocks": [
    {
      "type": "Product",
      "name": "Products",
      "settings": [
        {
          "type": "header",
          "content": "Select Product"
        },
        {
          "type": "product",
          "label": "Select Product",
          "id": "product"
        },
        {
          "type": "header",
          "content": "Mobile Dot tooltip range"
        },
        {
          "type": "range",
          "id": "mob_dot_range_top",
          "min": 0,
          "max": 100,
          "label": "Dot Position from Top",
          "step": 1,
          "default": 50
        },
        {
          "type": "range",
          "id": "mob_dot_range_left",
          "min": 0,
          "max": 100,
          "label": "Dot Position from Left",
          "step": 1,
          "default": 50
        },
        {
          "type": "header",
          "content": "Desktop Dot tooltip range"
        },
        {
          "type": "range",
          "id": "dot_range_top",
          "min": 0,
          "max": 100,
          "label": "Dot Position from Top",
          "step": 1,
          "default": 50
        },
        {
          "type": "range",
          "id": "dot_range_left",
          "min": 0,
          "max": 100,
          "label": "Dot Position from Left",
          "step": 1,
          "default": 50
        },
        {
          "type": "header",
          "content": "Enter tooltip Content"
        },
        {
          "type": "select",
          "id": "tooltip_alignment",
          "label": "tooltip alignment",
          "default": "right",
          "options": [
            {
              "label": "Left",
              "value": "left"
            },
            {
              "label": "Right",
              "value": "right"
            }
          ]
        },
        {
          "type": "text",
          "id": "title_tooltip",
          "label": "Tooltip Title",
          "default": "MELISSA KAYE"
        },
        {
          "type": "text",
          "id": "tooltip_content",
          "label": "sub title",
          "default": "Lola enamel diamond ring"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Shop Look V2",
      "category": "Custom",
      "blocks": [
        {
          "type": "Product"
        }
      ]
    }
  ]
}
{% endschema %}
