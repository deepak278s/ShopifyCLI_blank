{% comment %} {% render 'vite-tag' with '@@/jquery.js' %} {% endcomment %}
{% comment %}
  {% render 'vite-tag' with '@@/slick.min.js' %}
  {% render 'vite-tag' with '@@/slick.css' %}
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
{% endcomment %}
{% render 'vite-tag' with '@modules/keen-v2.js' %}
{% style %}
  .banner-carousel.keen-slider {
    visibility: visible;
    opacity: 1;
    transition: all 0.3s ease-out;
    display: flex;
    flex-direction: row;
    flex-wrap: nowrap;
  }
  @media (min-width: 768px) {
    .banner-carousel__wrapper {
      padding-left: 200px;
      padding-right: 200px;
    }
  }
{% endstyle %}

{% comment %} {% render 'vite-tag' with '@modules/keen-v2.js' %} {% endcomment %}
<style>
  {% for block in section.blocks %}
      .block__{{ block.id }} h2 {
          font-size: {{ block.settings.font_size }}px;
      }
      @media (min-width: 1024px) and (max-width: 1200px) {
          .block__{{ block.id }} h2 {
              font-size: calc({{ block.settings.font_size }}px * 0.85);
          }
      }
      @media (max-width: 1024px) {
          .block__{{ block.id }} h2 {
              font-size: calc({{ block.settings.font_size }}px * 0.75);
          }
      }
  {% endfor %}
</style>

<div class="banner-carousel__wrapper">
  <div class="banner-carousel keen-slider" {{ section.id }}>
    {%- comment -%} Slide {%- endcomment -%}
    {% if section.blocks.size >= 2 %}
      {% assign lastBlockCount = section.blocks.size | minus: 1 %}
      {% assign block = section.blocks[lastBlockCount] %}
      <div class="block__{{ block.id }} keen-slider__slide" {{ block.shopify_attributes }}>
        <div class="banner-carousel__container">
          <a href="{{ block.settings.link }}">
            <div class="banner-carousel__image">
              {% if block.settings.image %}
                <img
                  title="{{ block.settings.image.alt }}"
                  alt="{{ block.settings.image.alt }}"
                  src="{{ block.settings.image | img_url: 'master' }}"
                >
              {% else %}
                <img src="https://via.placeholder.com/750">
              {% endif %}
            </div>
            <div class="banner-carousel__content">
              <div>
                {% if block.settings.upper_text %}
                  <span class="fnt-sec uc fw-300">{{ block.settings.upper_text }}</span>
                {% endif %}
              </div>
              <div class="banner-carousel__content--title">
                {% if block.settings.heading %}
                  <h2>
                    {{ block.settings.heading }}
                    {% if block.settings.sticker %}
                      <img
                        class="sticker-image"
                        title="{{ block.settings.sticker.alt }}"
                        alt="{{ block.settings.sticker.alt }}"
                        src="{{ block.settings.sticker | img_url: 'master' }}"
                      >
                    {% endif %}
                  </h2>
                {% endif %}
              </div>
              <div>
                {% if block.settings.lower_text %}
                  <span class="fnt-sec uc fw-300">{{ block.settings.lower_text }}</span>
                {% endif %}
              </div>
            </div>
          </a>
        </div>
      </div>
    {% endif %}
    {% for block in section.blocks %}
      <div class="block__{{ block.id }} keen-slider__slide" {{ block.shopify_attributes }}>
        <div class="banner-carousel__container">
          <a href="{{ block.settings.link }}">
            <div class="banner-carousel__image">
              {% if block.settings.image %}
                <img
                  title="{{ block.settings.image.alt }}"
                  alt="{{ block.settings.image.alt }}"
                  src="{{ block.settings.image | img_url: 'master' }}"
                >
              {% else %}
                <img src="https://via.placeholder.com/750">
              {% endif %}
            </div>
            <div class="banner-carousel__content">
              <div>
                {% if block.settings.upper_text %}
                  <span class="fnt-sec uc fw-300">{{ block.settings.upper_text }}</span>
                {% endif %}
              </div>
              <div class="banner-carousel__content--title">
                {% if block.settings.heading %}
                  <h2>
                    {{ block.settings.heading }}
                    {% if block.settings.sticker %}
                      <img
                        class="sticker-image"
                        title="{{ block.settings.sticker.alt }}"
                        alt="{{ block.settings.sticker.alt }}"
                        src="{{ block.settings.sticker | img_url: 'master' }}"
                      >
                    {% endif %}
                  </h2>
                {% endif %}
              </div>
              <div>
                {% if block.settings.lower_text %}
                  <span class="fnt-sec uc fw-300">{{ block.settings.lower_text }}</span>
                {% endif %}
              </div>
            </div>
          </a>
        </div>
      </div>
    {% endfor %}
    {% if section.blocks.size >= 2 %}
      {% assign block = section.blocks[0] %}
      <div class="block__{{ block.id }} keen-slider__slide" {{ block.shopify_attributes }}>
        <div class="banner-carousel__container">
          <a href="{{ block.settings.link }}">
            <div class="banner-carousel__image">
              {% if block.settings.image %}
                <img
                  title="{{ block.settings.image.alt }}"
                  alt="{{ block.settings.image.alt }}"
                  src="{{ block.settings.image | img_url: 'master' }}"
                >
              {% else %}
                <img src="https://via.placeholder.com/750">
              {% endif %}
            </div>
            <div class="banner-carousel__content">
              <div>
                {% if block.settings.upper_text %}
                  <span class="fnt-sec uc fw-300">{{ block.settings.upper_text }}</span>
                {% endif %}
              </div>
              <div class="banner-carousel__content--title">
                {% if block.settings.heading %}
                  <h2>
                    {{ block.settings.heading }}
                    {% if block.settings.sticker %}
                      <img
                        class="sticker-image"
                        title="{{ block.settings.sticker.alt }}"
                        alt="{{ block.settings.sticker.alt }}"
                        src="{{ block.settings.sticker | img_url: 'master' }}"
                      >
                    {% endif %}
                  </h2>
                {% endif %}
              </div>
              <div>
                {% if block.settings.lower_text %}
                  <span class="fnt-sec uc fw-300">{{ block.settings.lower_text }}</span>
                {% endif %}
              </div>
            </div>
          </a>
        </div>
      </div>
    {% endif %}
  </div>
  {%- comment -%} Arrows {%- endcomment -%}
  <div class="arrows">
    <button class="arrow__prev">{%- render 'icons', icon: 'chevron-left' -%}</button>
    <button class="arrow__next">{%- render 'icons', icon: 'chevron-right' -%}</button>
  </div>
</div>

<script>
    document.addEventListener("custom:keenLoaded",(e) =>{
      let Slider = e.detail.slider;
      new Slider('.banner-carousel', {
      loop: true,
  },[
    slider => {
      slider.on('created', () => {
        slider.moveToIdx(1)
      }),
      slider.on('slideChanged',() =>{
        console.log('slideChanged')
      })
    },
  ])
    })
    {% comment %} $(function () {
      slick_slider();
    });

    $(document).on('shopify:section:load', function () {
      slick_slider();
    });

    $(document).on('shopify:section:unload', function () {
      slick_slider();
    });

    $(document).on('shopify:section:select', function () {
      slick_slider();
    });

    $(document).on('shopify:section:deselect', function () {
      slick_slider();
    });
    $(document).on('shopify:block:select', function () {
      // Ignore the cloned version
      var $slide = $('.block__' + event.detail.blockId + ':not(.slick-cloned)');
      var slideIndex = $slide.data('slick-index');
      // Go to selected slide, pause autoplay
      $('.banner-carousel').slick('slickGoTo', slideIndex).slick('slickPause');
    });
    // Slick Slider
    function slick_slider() {
      $('.banner-carousel')
        .not('.slick-initialized')
        .slick({
          nextArrow: $('.arrow__next'),
          prevArrow: $('.arrow__prev'),
          slidesToScroll: 1,
          centerMode: true,
          centerPadding: '180px',
          variableWidth: false,
          responsive: [
            {
              breakpoint: 767,
              settings: {
                dots: true,
                arrows: false,
                centerMode: false,
                slidesToShow: 1,
                slidesToScroll: 1,
              },
            },
          ],
        });
    } {% endcomment %}
</script>

{% schema %}
{
  "name": "Carouse Banner",
  "settings": [],
  "blocks": [
    {
      "name": "Slide",
      "type": "image",
      "settings": [
        {
          "type": "header",
          "content": "Image"
        },
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "header",
          "content": "Text"
        },
        {
          "type": "text",
          "id": "upper_text",
          "label": "Text (top)",
          "default": "New arrival"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Heading"
        },
        {
          "type": "text",
          "id": "lower_text",
          "label": "Text (bottom)",
          "default": "Shop the edit"
        },
        {
          "type": "header",
          "content": "Style"
        },
        {
          "type": "range",
          "id": "font_size",
          "min": 24,
          "max": 100,
          "step": 1,
          "unit": "px",
          "label": "Font size",
          "default": 64
        },
        {
          "type": "header",
          "content": "URL"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Link"
        },
        {
          "type": "header",
          "content": "Sticker"
        },
        {
          "type": "image_picker",
          "id": "sticker",
          "label": "Image"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Carousel Banner",
      "settings": {}
    }
  ]
}
{% endschema %}
